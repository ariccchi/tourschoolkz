{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{useParams,useNavigate}from'react-router-dom';import{jwtDecode}from'jwt-decode';import{BrowserRouter as Router,Route,Link,Switch}from'react-router-dom';import Startnewcourse from'./Startnewcourse';import axios from\"axios\";import LessonsPanel from'./LessonsPanel';import{BASE_URL}from'./config';import{jsx as _jsx}from\"react/jsx-runtime\";function LessonListPage(){const[hasAccess,setHasAccess]=useState(true);const{title}=useParams();const navigate=useNavigate();const titleWithSpaces=title.replace(/-/g,' ');const[responseData,setResponseData]=useState(null);const[userRole,setUserRole]=useState(null);const[data,setData]=useState([]);const token=localStorage.getItem('token');const decodedToken=jwtDecode(token);const id=decodedToken.sub;const fetchData=useCallback(async()=>{try{const response=await axios.post(\"\".concat(BASE_URL,\"tourschoolphp/lessonlist.php\"),{title:titleWithSpaces});if(!response.data){throw new Error('Пустой ответ от сервера');}setResponseData(response.data);}catch(error){console.error('Ошибка при запросе данных:',error);}},[titleWithSpaces]);useEffect(()=>{const checkCourseAccess=async()=>{try{const token=localStorage.getItem('token');const userId=token?jwtDecode(token).sub:null;const response=await axios.post(\"\".concat(BASE_URL,\"tourschoolphp/checkCourseAccess.php\"),{user_id:userId,course_name:titleWithSpaces});if(!response.data||response.data.length===0){setHasAccess(false);return;}fetchData();}catch(error){console.error('Ошибка при проверке доступа:',error);}};checkCourseAccess();},[titleWithSpaces,fetchData]);useEffect(()=>{const token=localStorage.getItem('token');if(token){setUserRole(jwtDecode(token).role);}},[fetchData]);return/*#__PURE__*/_jsx(\"div\",{className:\"connews\",children:hasAccess?responseData?/*#__PURE__*/_jsx(LessonsPanel,{}):/*#__PURE__*/_jsx(\"p\",{children:\"\\u041F\\u0440\\u043E\\u0432\\u0435\\u0440\\u043A\\u0430 \\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u0430...\"}):/*#__PURE__*/_jsx(Startnewcourse,{})});}export default LessonListPage;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useParams","useNavigate","jwtDecode","BrowserRouter","Router","Route","Link","Switch","Startnewcourse","axios","LessonsPanel","BASE_URL","jsx","_jsx","LessonListPage","hasAccess","setHasAccess","title","navigate","titleWithSpaces","replace","responseData","setResponseData","userRole","setUserRole","data","setData","token","localStorage","getItem","decodedToken","id","sub","fetchData","response","post","concat","Error","error","console","checkCourseAccess","userId","user_id","course_name","length","role","className","children"],"sources":["/Applications/MAMP/htdocs/gitrepo/tourclubkz/my-react-app/src/Lessonlist.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { jwtDecode } from 'jwt-decode';\nimport { BrowserRouter as Router, Route, Link, Switch } from 'react-router-dom';\nimport Startnewcourse from './Startnewcourse';\nimport axios from \"axios\";\nimport LessonsPanel from './LessonsPanel';\nimport { BASE_URL } from './config';\nfunction LessonListPage() {\n  const [hasAccess, setHasAccess] = useState(true);\n  const { title } = useParams();\n  const navigate = useNavigate();\n  const titleWithSpaces = title.replace(/-/g, ' ');\n  const [responseData, setResponseData] = useState(null);\n  const [userRole, setUserRole] = useState(null);\n  const [data, setData] = useState([]);\n  const token = localStorage.getItem('token');\n  const decodedToken = jwtDecode(token);\n  const id = decodedToken.sub;\n  const fetchData = useCallback(async () => {\n    try {\n      const response = await axios.post(`${BASE_URL}tourschoolphp/lessonlist.php`, {\n        title: titleWithSpaces,\n      });\n      \n      if (!response.data) {\n        throw new Error('Пустой ответ от сервера');\n      }\n      \n      setResponseData(response.data);\n      \n    } catch (error) {\n      console.error('Ошибка при запросе данных:', error);\n    }\n  }, [titleWithSpaces]);\n\n  useEffect(() => {\n    const checkCourseAccess = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        const userId = token ? jwtDecode(token).sub : null;\n\n        const response = await axios.post(`${BASE_URL}tourschoolphp/checkCourseAccess.php`, {\n          user_id: userId,\n          course_name: titleWithSpaces,\n        });\n\n        if (!response.data || response.data.length === 0) {\n         \n          setHasAccess(false);\n          return;\n        }\n\n        fetchData();\n      } catch (error) {\n        console.error('Ошибка при проверке доступа:', error);\n      }\n    };\n\n    checkCourseAccess();\n  }, [titleWithSpaces, fetchData]);\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      setUserRole(jwtDecode(token).role);\n    }\n  }, [fetchData]);\n\n  \n\n  return (\n    <div className='connews'>\n      {hasAccess ? (\n        responseData ? (\n          <LessonsPanel />\n        ) : (\n          <p>Проверка доступа...</p>\n        )\n      ) : (\n        <Startnewcourse />\n      )}\n    </div>\n  );\n}\n\nexport default LessonListPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}