{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback}from'react';import{useParams,useNavigate,Link}from'react-router-dom';import Navpanmini from'./navpanmini';import{jwtDecode}from'jwt-decode';import{BASE_URL}from'./config';//CSS lessonlistpanel.css\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Lessonpdf(){const navigate=useNavigate();// Используйте useNavigate\nconst{title}=useParams();const titleWithSpaces=title.replace(/-/g,' ');const{lesson}=useParams();const lessonWithSpaces=lesson.replace(/-/g,' ');const[responseData,setResponseData]=useState(null);const[loading,setLoading]=useState(true);const token=localStorage.getItem('token');let decoded=jwtDecode(token);let user_id=decoded.sub;useEffect(()=>{const checkResultAndShowVideo=async()=>{console.log(user_id);try{const checkResultResponse=await fetch(\"\".concat(BASE_URL,\"tourschoolphp/Checkresulttoshowvideo.php\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user_id,title:lessonWithSpaces,course:titleWithSpaces})});if(!checkResultResponse.ok){throw new Error('Ошибка при проверке результата для отображения видео');}const checkResultData=await checkResultResponse.json();// Check if checkResultData is an array before accessing its elements\nif(Array.isArray(checkResultData)&&checkResultData.length>0){// Вывод данных из PHP-скрипта в консоль\nconsole.log('Response from PHP script:',checkResultData);// Извлекаем значение available_at из первого элемента массива\nconst availableAt=checkResultData[0].available_at;console.log('available_at:',availableAt);// Получаем текущее время клиента\nconst clientTime=new Date();// Получаем время с сервера и преобразуем его в объект Date (время сервера считаем в UTC)\nconst serverTimeUTC=new Date(availableAt);// Получаем смещение временной зоны клиента\nconst clientTimezoneOffset=clientTime.getTimezoneOffset();// Корректируем время сервера на смещение временной зоны клиента\nconst serverTime=new Date(serverTimeUTC.getTime()-clientTimezoneOffset*60000);console.log(serverTimeUTC);// Сравниваем время с сервера и времени клиента\nif(serverTime>clientTime){// Если время на сервере больше времени клиента, выполняем перенаправление\nnavigate('/courses');}else{}}}catch(error){// console.error('Ошибка при проверке результата для отображения видео:', error);\n}};checkResultAndShowVideo();},[user_id,lessonWithSpaces,titleWithSpaces]);useEffect(()=>{const fetchData=async()=>{try{const response=await fetch(\"\".concat(BASE_URL,\"tourschoolphp/lessonvideo.php\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({lesson:lessonWithSpaces,course:titleWithSpaces})});if(!response.ok){throw new Error('Ошибка при запросе данных');}const responseBody=await response.text();const data=JSON.parse(responseBody);setResponseData(data);}catch(error){console.error('Ошибка при отправке запроса:',error);}finally{// Устанавливаем статус загрузки в false после завершения запроса\nsetLoading(false);}};fetchData();},[titleWithSpaces]);console.log(responseData);return/*#__PURE__*/_jsxs(\"div\",{className:\"containerfortextlesson\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"form7\",src:\"/form7.svg\"}),/*#__PURE__*/_jsx(\"div\",{className:\"titlefortextlesson\",children:lessonWithSpaces}),/*#__PURE__*/_jsx(\"div\",{className:\"fileinfo\",children:\"\\u0418\\u0437\\u0443\\u0447\\u0438\\u0442\\u0435 \\u0444\\u0430\\u0439\\u043B, \\u0432\\u044B\\u043F\\u0438\\u0448\\u0438\\u0442\\u0435 \\u0441\\u0430\\u043C\\u043E\\u0435 \\u0433\\u043B\\u0430\\u0432\\u043D\\u043E\\u0435\"}),/*#__PURE__*/_jsx(\"div\",{className:\"fileinfo\",children:\"\\u0417\\u0430\\u0442\\u0435\\u043C \\u043F\\u0440\\u043E\\u0439\\u0434\\u0438\\u0442\\u0435 \\u0442\\u0435\\u0441\\u0442\"}),/*#__PURE__*/_jsx(\"a\",{className:\"filetext\",href:\"\".concat(BASE_URL,\"tourschoolphp/\").concat(responseData),download:true,children:\"\\u0421\\u043A\\u0430\\u0447\\u0430\\u0442\\u044C \\u0444\\u0430\\u0439\\u043B\"}),/*#__PURE__*/_jsx(Link,{to:\"/courses/\".concat(title,\"/\").concat(lesson,\"/finaltest\"),children:/*#__PURE__*/_jsx(\"div\",{className:\"filetest\",children:\"\\u041F\\u0440\\u043E\\u0439\\u0442\\u0438 \\u0442\\u0435\\u0441\\u0442\"})}),/*#__PURE__*/_jsx(Navpanmini,{})]});}export default Lessonpdf;","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useParams","useNavigate","Link","Navpanmini","jwtDecode","BASE_URL","jsx","_jsx","jsxs","_jsxs","Lessonpdf","navigate","title","titleWithSpaces","replace","lesson","lessonWithSpaces","responseData","setResponseData","loading","setLoading","token","localStorage","getItem","decoded","user_id","sub","checkResultAndShowVideo","console","log","checkResultResponse","fetch","concat","method","headers","body","JSON","stringify","course","ok","Error","checkResultData","json","Array","isArray","length","availableAt","available_at","clientTime","Date","serverTimeUTC","clientTimezoneOffset","getTimezoneOffset","serverTime","getTime","error","fetchData","response","responseBody","text","data","parse","className","children","src","href","download","to"],"sources":["/Applications/MAMP/htdocs/gitrepo/tourclubkz/my-react-app/src/lessonpdf.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport Navpanmini from './navpanmini';\nimport { jwtDecode } from 'jwt-decode';\nimport { BASE_URL } from './config';\n\n//CSS lessonlistpanel.css\nfunction Lessonpdf() {\n    \n    const navigate = useNavigate(); // Используйте useNavigate\n    const { title } = useParams();\n    const titleWithSpaces = title.replace(/-/g, ' ');\n    const { lesson } = useParams();\n    const lessonWithSpaces = lesson.replace(/-/g, ' ');\n    const [responseData, setResponseData] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const token = localStorage.getItem('token');\n\n\nlet decoded = jwtDecode(token);\n\nlet user_id = decoded.sub;\n    useEffect(() => {\n        const checkResultAndShowVideo = async () => {\n          console.log(user_id);\n      \n          try {\n            const checkResultResponse = await fetch(`${BASE_URL}tourschoolphp/Checkresulttoshowvideo.php`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                user_id: user_id,\n                title: lessonWithSpaces,\n                course: titleWithSpaces,\n              }),\n            });\n      \n            if (!checkResultResponse.ok) {\n              throw new Error('Ошибка при проверке результата для отображения видео');\n            }\n      \n            const checkResultData = await checkResultResponse.json();\n      \n            // Check if checkResultData is an array before accessing its elements\n            if (Array.isArray(checkResultData) && checkResultData.length > 0) {\n              // Вывод данных из PHP-скрипта в консоль\n              console.log('Response from PHP script:', checkResultData);\n      \n              // Извлекаем значение available_at из первого элемента массива\n              const availableAt = checkResultData[0].available_at;\n              console.log('available_at:', availableAt);\n      \n              // Получаем текущее время клиента\n              const clientTime = new Date();\n      \n              // Получаем время с сервера и преобразуем его в объект Date (время сервера считаем в UTC)\n              const serverTimeUTC = new Date(availableAt);\n      \n              // Получаем смещение временной зоны клиента\n              const clientTimezoneOffset = clientTime.getTimezoneOffset();\n      \n              // Корректируем время сервера на смещение временной зоны клиента\n              const serverTime = new Date(serverTimeUTC.getTime() - clientTimezoneOffset * 60000);\n              console.log(serverTimeUTC);\n      \n              // Сравниваем время с сервера и времени клиента\n              if (serverTime > clientTime) {\n                // Если время на сервере больше времени клиента, выполняем перенаправление\n                navigate('/courses');\n              } else {\n           \n              }\n            } \n          } catch (error) {\n            // console.error('Ошибка при проверке результата для отображения видео:', error);\n          }\n        };\n      \n        checkResultAndShowVideo();\n      }, [user_id, lessonWithSpaces, titleWithSpaces]);\n      \n   useEffect(() => {\n        const fetchData = async () => {\n          try {\n            const response = await fetch(`${BASE_URL}tourschoolphp/lessonvideo.php`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({ lesson: lessonWithSpaces, course: titleWithSpaces }),\n            });\n      \n            if (!response.ok) {\n              throw new Error('Ошибка при запросе данных');\n            }\n      \n            const responseBody = await response.text();\n            const data = JSON.parse(responseBody);\n            setResponseData(data);\n          } catch (error) {\n            console.error('Ошибка при отправке запроса:', error);\n          } finally {\n            // Устанавливаем статус загрузки в false после завершения запроса\n            setLoading(false);\n        }\n    };\n    fetchData();\n}, [titleWithSpaces]);\nconsole.log(responseData);\n return (\n\n<div className=\"containerfortextlesson\">\n<img className='form7' src='/form7.svg'></img>\n<div className=\"titlefortextlesson\">{lessonWithSpaces}</div>\n<div className=\"fileinfo\">Изучите файл, выпишите самое главное</div>\n<div className=\"fileinfo\">Затем пройдите тест</div>\n\n    <a className='filetext' href={`${BASE_URL}tourschoolphp/${responseData}`} download>Скачать файл</a>\n\n\n\n<Link to={`/courses/${title}/${lesson}/finaltest`}>\n<div className=\"filetest\">Пройти тест</div>\n</Link>\n<Navpanmini/>\n</div>\n    \n )   \n}\nexport default Lessonpdf;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}